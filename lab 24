import pandas as pd
import numpy as np
import seaborn as sns
import matplotlib.pyplot as plt
from sklearn.feature_selection import VarianceThreshold
from sklearn.linear_model import LinearRegression

a = pd.read_csv("day24_selection.csv")

b = a.drop("target", axis=1)
c = a["target"]

b = b.select_dtypes(include=np.number)

m1 = LinearRegression()
m1.fit(b, c)
r1 = m1.score(b, c)
print("Before feature selection:", r1)

d = VarianceThreshold(0.0)
e = d.fit_transform(b)
f = b.columns[d.get_support()]
g = pd.DataFrame(e, columns=f)

h = g.corr().abs()

plt.figure(figsize=(12, 10))
sns.heatmap(h, annot=True, fmt=".2f", cmap="coolwarm")
plt.title("Correlation Heatmap")
plt.show()

i = set()
for j in range(len(h.columns)):
    for k in range(j):
        if h.iloc[j, k] > 0.9:
            i.add(h.columns[j])

l = g.drop(columns=i)

if l.shape[1] > 0:
    m2 = LinearRegression()
    m2.fit(l, c)
    r2 = m2.score(l, c)
    print("After feature selection:", r2)
else:
    print("After feature selection: no features left")
